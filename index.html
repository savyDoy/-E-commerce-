<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mey Mey Store | Official</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --primary: #2563eb;
            --surface: #ffffff;
            --bg: #f8fafc;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--bg);
            -webkit-tap-highlight-color: transparent;
        }

        .glass {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .product-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .product-card:active {
            transform: scale(0.96);
        }

        .category-pill {
            transition: all 0.3s ease;
        }

        .category-pill.active {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3);
        }

        .shimmer {
            background: linear-gradient(90deg, #f1f5f9 25%, #f8fafc 50%, #f1f5f9 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="text-slate-900 antialiased">

    <!-- Premium Navigation -->
    <nav class="glass sticky top-0 z-50 border-b border-slate-200/60">
        <div class="max-w-7xl mx-auto px-5 h-20 flex items-center justify-between">
            <div class="flex flex-col select-none">
                <span class="text-2xl font-extrabold tracking-tighter text-blue-600">MEY MEY</span>
                <span class="text-[10px] font-bold tracking-[0.2em] text-slate-400 uppercase -mt-1">Collection</span>
            </div>
            
            <div class="flex items-center gap-3">
                <button onclick="toggleCart()" class="relative group p-3 bg-white border border-slate-200 rounded-2xl hover:border-blue-300 transition-all shadow-sm active:scale-90">
                    <svg class="w-6 h-6 text-slate-700 group-hover:text-blue-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                    </svg>
                    <span id="cart-count" class="absolute -top-1 -right-1 bg-blue-600 text-white text-[11px] font-black px-2 py-0.5 rounded-full ring-4 ring-white shadow-lg">0</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="max-w-7xl mx-auto px-5 pt-8 pb-32">
        
        <!-- Hero Search Section -->
        <div class="mb-10">
            <h2 class="text-3xl font-extrabold text-slate-900 mb-6">Discover <span class="text-blue-600">Premium</span> Styles</h2>
            <div class="relative group">
                <input type="text" id="product-search" oninput="handleFilter()" placeholder="Search items..." 
                       class="w-full bg-white border-2 border-slate-100 p-5 rounded-[2rem] pl-14 text-slate-800 placeholder:text-slate-400 outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all shadow-sm">
                <svg class="w-6 h-6 absolute left-5 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
            </div>
        </div>

        <!-- Filter Chips -->
        <div id="category-list" class="flex gap-3 overflow-x-auto pb-8 hide-scrollbar">
            <button onclick="selectCategory('All')" class="category-pill active whitespace-nowrap px-8 py-3 rounded-2xl border-2 border-slate-100 font-bold text-sm">All Items</button>
        </div>

        <!-- Product Grid -->
        <div id="loader" class="grid grid-cols-2 md:grid-cols-4 gap-6">
            <div class="h-80 shimmer rounded-[2.5rem]"></div>
            <div class="h-80 shimmer rounded-[2.5rem]"></div>
            <div class="h-80 shimmer rounded-[2.5rem] hidden md:block"></div>
            <div class="h-80 shimmer rounded-[2.5rem] hidden md:block"></div>
        </div>
        <div id="grid" class="grid grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-5 md:gap-8"></div>
    </main>

    <!-- Cart Overlay & Sidebar -->
    <div id="cart-sidebar" class="fixed inset-y-0 right-0 w-full max-w-md bg-white shadow-[-20px_0_60px_-15px_rgba(0,0,0,0.1)] z-[60] translate-x-full transition-transform duration-500 ease-out flex flex-col">
        <div class="p-8 border-b border-slate-100 flex justify-between items-center">
            <div>
                <h2 class="text-2xl font-extrabold text-slate-900">Your Tray</h2>
                <p class="text-xs text-slate-400 font-bold uppercase tracking-widest mt-1">Review Items</p>
            </div>
            <button onclick="toggleCart()" class="p-3 bg-slate-50 text-slate-400 rounded-2xl hover:text-slate-900 transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
        </div>
        
        <div id="cart-items" class="flex-1 overflow-y-auto p-8 space-y-6 hide-scrollbar"></div>

        <div class="p-8 bg-slate-50 border-t border-slate-100 rounded-t-[3rem] shadow-[0_-10px_40px_rgba(0,0,0,0.03)]">
            <!-- Checkout Form -->
            <div id="checkout-form" class="space-y-4 mb-8 hidden">
                <div class="flex items-center gap-2 mb-2">
                    <div class="w-1.5 h-6 bg-blue-600 rounded-full"></div>
                    <h4 class="text-sm font-black text-slate-800 uppercase tracking-tight">Delivery Details</h4>
                </div>
                <div class="space-y-3">
                    <input id="cust-name" type="text" placeholder="Full Name" class="w-full p-4 rounded-2xl bg-white border border-slate-200 outline-none focus:ring-4 ring-blue-500/10 focus:border-blue-500 transition-all text-sm font-medium">
                    <input id="cust-phone" type="tel" placeholder="Phone Number" class="w-full p-4 rounded-2xl bg-white border border-slate-200 outline-none focus:ring-4 ring-blue-500/10 focus:border-blue-500 transition-all text-sm font-medium">
                    <input id="cust-loc" type="text" placeholder="Delivery Address / Landmark" class="w-full p-4 rounded-2xl bg-white border border-slate-200 outline-none focus:ring-4 ring-blue-500/10 focus:border-blue-500 transition-all text-sm font-medium">
                </div>
            </div>

            <div class="flex justify-between items-end mb-8">
                <div>
                    <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">Grand Total</span>
                    <div id="cart-total" class="text-4xl font-black text-blue-600 leading-none mt-1">$0.00</div>
                </div>
            </div>
            
            <button id="main-checkout-btn" onclick="showForm()" class="group w-full bg-slate-900 text-white py-5 rounded-[2rem] font-bold shadow-xl shadow-slate-200 hover:bg-blue-600 hover:shadow-blue-200 transition-all flex items-center justify-center gap-3 active:scale-95">
                PROCEED TO CHECKOUT
                <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
            </button>
            
            <button id="tg-checkout-btn" onclick="sendToTelegram()" class="w-full bg-[#24A1DE] text-white py-5 rounded-[2rem] font-bold shadow-xl shadow-blue-100 hidden flex items-center justify-center gap-3 active:scale-95">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69.01-.03.01-.14-.07-.2-.08-.06-.19-.04-.27-.02-.11.02-1.93 1.23-5.46 3.62-.51.35-.98.52-1.4.51-.46-.01-1.35-.26-2.01-.48-.81-.27-1.45-.42-1.39-.88.03-.24.36-.49.99-.75 3.88-1.69 6.46-2.8 7.74-3.33 3.68-1.53 4.44-1.8 4.94-1.81.11 0 .36.03.52.16.13.11.17.26.19.37z"/></svg>
                CONFIRM ON TELEGRAM
            </button>
        </div>
    </div>

    <script>
        // --- CONSTANTS ---
        const TG_ADMIN_USER = "Sa-vy1410";
        const API_URL = "https://script.google.com/macros/s/AKfycbynIlGf2LqI2SWI7MFT6M55e17MKK94r74aUg3jwgJTShCMZKeByZbfH--ya0rpOxz7gg/exec";
        
        let products = [];
        let cart = [];
        let selectedCategory = 'All';

        async function fetchData() {
            const loader = document.getElementById('loader');
            const grid = document.getElementById('grid');
            
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                products = data.products || [];
                renderCategories();
                handleFilter();
            } catch (e) {
                console.error("Fetch Error:", e);
                grid.innerHTML = `<div class="col-span-full py-20 text-center text-slate-400">Unable to load catalog. Please refresh.</div>`;
            } finally { 
                loader.classList.add('hidden');
            }
        }

        function renderCategories() {
            const list = document.getElementById('category-list');
            const cats = ['All', ...new Set(products.map(p => p.category).filter(Boolean))];
            list.innerHTML = cats.map(c => `
                <button onclick="selectCategory('${c}')" 
                        class="category-pill ${selectedCategory === c ? 'active' : ''} whitespace-nowrap px-8 py-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-white shadow-sm hover:border-blue-200">
                    ${c === 'All' ? 'All Items' : c}
                </button>
            `).join('');
        }

        function selectCategory(c) { 
            selectedCategory = c; 
            renderCategories(); 
            handleFilter(); 
        }

        function handleFilter() {
            const query = document.getElementById('product-search').value.toLowerCase();
            const filtered = products.filter(p => {
                const pName = (p.nameEn || p.name?.en || p.name || '').toLowerCase();
                const matchName = pName.includes(query);
                const matchCat = selectedCategory === 'All' || p.category === selectedCategory;
                return matchName && matchCat;
            });
            renderProducts(filtered);
        }

        function renderProducts(items) {
            const grid = document.getElementById('grid');
            if(items.length === 0) {
                grid.innerHTML = `<div class="col-span-full py-20 text-center text-slate-400 font-medium">No products found.</div>`;
                return;
            }
            grid.innerHTML = items.map((p, idx) => {
                const name = p.nameEn || p.name?.en || p.name || 'Unknown Product';
                const price = (parseFloat(p.price) || 0).toFixed(2);
                const img = p.imageUrl || p.img || 'https://via.placeholder.com/400x500?text=No+Image';
                
                return `
                    <div class="product-card group bg-white rounded-[2.5rem] border border-slate-100 overflow-hidden hover:shadow-2xl hover:shadow-blue-500/10 transition-all duration-500">
                        <div class="aspect-[4/5] bg-slate-50 relative overflow-hidden">
                            <img src="${img}" alt="${name}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700 ease-out">
                        </div>
                        <div class="p-6">
                            <div class="mb-1">
                                <span class="text-[10px] font-black uppercase tracking-widest text-blue-500">${p.category || 'New Arrival'}</span>
                            </div>
                            <h3 class="font-bold text-slate-800 text-base line-clamp-1 mb-4">${name}</h3>
                            <div class="flex items-center justify-between">
                                <span class="text-xl font-black text-slate-900">$${price}</span>
                                <button onclick="addToCartByData('${idx}')" class="bg-slate-900 text-white p-3.5 rounded-2xl hover:bg-blue-600 active:scale-90 transition-all shadow-lg shadow-slate-100">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Add to cart helper that works with filtered lists
        window.addToCartByData = (idx) => {
            const query = document.getElementById('product-search').value.toLowerCase();
            const currentItems = products.filter(p => {
                const pName = (p.nameEn || p.name?.en || p.name || '').toLowerCase();
                const matchCat = selectedCategory === 'All' || p.category === selectedCategory;
                return pName.includes(query) && matchCat;
            });
            cart.push(currentItems[idx]);
            updateCartUI();
        };

        function removeFromCart(idx) {
            cart.splice(idx, 1);
            updateCartUI();
        }

        function updateCartUI() {
            document.getElementById('cart-count').innerText = cart.length;
            const container = document.getElementById('cart-items');
            
            if(cart.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-slate-300">
                        <svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
                        <p class="font-bold">Your tray is empty</p>
                    </div>
                `;
                document.getElementById('checkout-form').classList.add('hidden');
                document.getElementById('tg-checkout-btn').classList.add('hidden');
                document.getElementById('main-checkout-btn').classList.remove('hidden');
            } else {
                container.innerHTML = cart.map((item, idx) => `
                    <div class="flex items-center gap-5 bg-white p-4 rounded-3xl border border-slate-50 shadow-sm">
                        <img src="${item.imageUrl || item.img}" class="w-16 h-16 rounded-2xl object-cover">
                        <div class="flex-1 min-w-0">
                            <h4 class="text-xs font-bold text-slate-800 truncate">${item.nameEn || item.name || 'Item'}</h4>
                            <p class="text-blue-600 font-black text-sm mt-1">$${(parseFloat(item.price) || 0).toFixed(2)}</p>
                        </div>
                        <button onclick="removeFromCart(${idx})" class="w-8 h-8 flex items-center justify-center bg-slate-50 text-slate-400 rounded-full hover:text-rose-500">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"/></svg>
                        </button>
                    </div>
                `).join('');
            }
            
            const total = cart.reduce((sum, i) => sum + (parseFloat(i.price) || 0), 0);
            document.getElementById('cart-total').innerText = `$${total.toFixed(2)}`;
        }

        function showForm() {
            if(cart.length === 0) return;
            document.getElementById('checkout-form').classList.remove('hidden');
            document.getElementById('main-checkout-btn').classList.add('hidden');
            document.getElementById('tg-checkout-btn').classList.remove('hidden');
            const sidebar = document.getElementById('cart-items');
            setTimeout(() => sidebar.scrollTo({ top: sidebar.scrollHeight, behavior: 'smooth' }), 100);
        }

        function toggleCart() { 
            document.getElementById('cart-sidebar').classList.toggle('translate-x-full'); 
        }

        function sendToTelegram() {
            const name = document.getElementById('cust-name').value.trim();
            const phone = document.getElementById('cust-phone').value.trim();
            const loc = document.getElementById('cust-loc').value.trim();

            if(!name || !phone || !loc) {
                alert("Please complete the delivery details.");
                return;
            }

            const total = cart.reduce((sum, i) => sum + (parseFloat(i.price) || 0), 0);
            
            let msg = `üõç *NEW ORDER RECEIVED*\n`;
            msg += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            msg += `üë§ *Customer:* ${name}\n`;
            msg += `üìû *Phone:* ${phone}\n`;
            msg += `üìç *Delivery:* ${loc}\n`;
            msg += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
            
            msg += `üì¶ *ITEMS PURCHASED:*\n`;
            const counts = {};
            cart.forEach(i => { const n = i.nameEn || i.name || 'Item'; counts[n] = (counts[n] || 0) + 1; });
            for(const [n, q] of Object.entries(counts)) { msg += `‚Ä¢ ${n} (x${q})\n`; }
            
            msg += `\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            msg += `üí∞ *TOTAL AMOUNT: $${total.toFixed(2)}*\n`;
            msg += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            msg += `_Sent via Mey Mey Store Online_`;

            const encoded = encodeURIComponent(msg);
            window.open(`https://t.me/${TG_ADMIN_USER}/?text=${encoded}`, '_blank');
            
            cart = [];
            updateCartUI();
            toggleCart();
        }

        window.onload = fetchData;
    </script>
</body>
</html>